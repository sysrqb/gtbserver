<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GTBServer: MySQLConn Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GTBServer
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">MySQLConn Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Handle connection to MySQL/MariaDB server.  
 <a href="classMySQLConn.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="sqlconn_8hpp_source.html">sqlconn.hpp</a>&gt;</code></p>

<p><a href="classMySQLConn-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa2995f013e14fbb9c195b6aa7226588b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#aa2995f013e14fbb9c195b6aa7226588b">MySQLConn</a> ()</td></tr>
<tr class="memdesc:aa2995f013e14fbb9c195b6aa7226588b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#aa2995f013e14fbb9c195b6aa7226588b"></a><br/></td></tr>
<tr class="memitem:a1a78abd249f89676dd3ae9cffe121ba0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a1a78abd249f89676dd3ae9cffe121ba0">~MySQLConn</a> ()</td></tr>
<tr class="memdesc:a1a78abd249f89676dd3ae9cffe121ba0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deconstructor.  <a href="#a1a78abd249f89676dd3ae9cffe121ba0"></a><br/></td></tr>
<tr class="memitem:acf71076f26a8e4c72c8d6d8376d6b3ff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#acf71076f26a8e4c72c8d6d8376d6b3ff">storeConnection</a> (void *ptr, gnutls_datum_t session_id, gnutls_datum_t session_data)</td></tr>
<tr class="memdesc:acf71076f26a8e4c72c8d6d8376d6b3ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store client session info used for session resume.  <a href="#acf71076f26a8e4c72c8d6d8376d6b3ff"></a><br/></td></tr>
<tr class="memitem:a0e7b657d78b0ab3199519546c8acae49"><td class="memItemLeft" align="right" valign="top">gnutls_datum_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a0e7b657d78b0ab3199519546c8acae49">getConnection</a> (void *ptr, gnutls_datum_t session_id)</td></tr>
<tr class="memdesc:a0e7b657d78b0ab3199519546c8acae49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve client session info used for session resume.  <a href="#a0e7b657d78b0ab3199519546c8acae49"></a><br/></td></tr>
<tr class="memitem:a081f010ada91cd0d0f67ab8dddb5d8af"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a081f010ada91cd0d0f67ab8dddb5d8af">storeCarInfo</a> (std::string ipaddr, int car)</td></tr>
<tr class="memdesc:a081f010ada91cd0d0f67ab8dddb5d8af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores client info that is used for authentication.  <a href="#a081f010ada91cd0d0f67ab8dddb5d8af"></a><br/></td></tr>
<tr class="memitem:ae96f09e4aa859a5294c90ec498c38928"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#ae96f09e4aa859a5294c90ec498c38928">checkAuth</a> (std::string i_snetid, std::string i_sauth, std::string i_scarnum)</td></tr>
<tr class="memdesc:ae96f09e4aa859a5294c90ec498c38928"><td class="mdescLeft">&#160;</td><td class="mdescRight">Authenticate client.  <a href="#ae96f09e4aa859a5294c90ec498c38928"></a><br/></td></tr>
<tr class="memitem:ab0a639e5ebb4220e82f4e4f994059774"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#ab0a639e5ebb4220e82f4e4f994059774">execAuth</a> (std::string hash)</td></tr>
<tr class="memdesc:ab0a639e5ebb4220e82f4e4f994059774"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unimplemented. I don't remember what this was supposed to do.  <a href="#ab0a639e5ebb4220e82f4e4f994059774"></a><br/></td></tr>
<tr class="memitem:a259785bc51cae6d0c6c950f6bdf6f475"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a259785bc51cae6d0c6c950f6bdf6f475">getCurr</a> (int carnum, <a class="el" href="classPatronList.html">PatronList</a> *i_apbPatl, std::vector&lt; int &gt;)</td></tr>
<tr class="memdesc:a259785bc51cae6d0c6c950f6bdf6f475"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return all rides currently assigned to the client.  <a href="#a259785bc51cae6d0c6c950f6bdf6f475"></a><br/></td></tr>
<tr class="memitem:a1653065e63d0dc420392b5694e688237"><td class="memItemLeft" align="right" valign="top">std::map&lt; int, std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a1653065e63d0dc420392b5694e688237">setUpdt</a> (int carnum, <a class="el" href="classPatronList.html">PatronList</a> *i_apbPatl, <a class="el" href="classRequest.html">Request</a> *i_aPBReq)</td></tr>
<tr class="memdesc:a1653065e63d0dc420392b5694e688237"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the information for each patron.  <a href="#a1653065e63d0dc420392b5694e688237"></a><br/></td></tr>
<tr class="memitem:a017c08a9bfdf5c20509f754af7c8c7f7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a017c08a9bfdf5c20509f754af7c8c7f7">addPatron</a> (int carnum, <a class="el" href="classRequest.html">Request</a> *i_aPBReq)</td></tr>
<tr class="memdesc:a017c08a9bfdf5c20509f754af7c8c7f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a new patron to the database.  <a href="#a017c08a9bfdf5c20509f754af7c8c7f7"></a><br/></td></tr>
<tr class="memitem:a045c9cb16434df8c1e50dd7ef6766c5f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a045c9cb16434df8c1e50dd7ef6766c5f">addLocation</a> (std::string loc)</td></tr>
<tr class="memdesc:a045c9cb16434df8c1e50dd7ef6766c5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert a new location into the database.  <a href="#a045c9cb16434df8c1e50dd7ef6766c5f"></a><br/></td></tr>
<tr class="memitem:ae26fdad9114c884ff5b8bfefebee4254"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#ae26fdad9114c884ff5b8bfefebee4254">getPatronInfo</a> (int pid, <a class="el" href="classPatronList.html">PatronList</a> *i_apbPatl)</td></tr>
<tr class="memdesc:ae26fdad9114c884ff5b8bfefebee4254"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the information in the database for the patron assigned to the pid/unique id pid.  <a href="#ae26fdad9114c884ff5b8bfefebee4254"></a><br/></td></tr>
<tr class="memitem:a8ffe3e96eb70c795c4ade821e70dd6bf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a8ffe3e96eb70c795c4ade821e70dd6bf">getLocationID</a> (std::string loc)</td></tr>
<tr class="memdesc:a8ffe3e96eb70c795c4ade821e70dd6bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the lid of loc.  <a href="#a8ffe3e96eb70c795c4ade821e70dd6bf"></a><br/></td></tr>
<tr class="memitem:a0ab687f92039d6f9934bcd638eecd8e6"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#a0ab687f92039d6f9934bcd638eecd8e6">getSHA256Hash</a> (std::string sdata, int size)</td></tr>
<tr class="memdesc:a0ab687f92039d6f9934bcd638eecd8e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return SHA256 hash of input string sdata.  <a href="#a0ab687f92039d6f9934bcd638eecd8e6"></a><br/></td></tr>
<tr class="memitem:ac8aac8ba065bf2f14d1861969a6e2c9e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMySQLConn.html#ac8aac8ba065bf2f14d1861969a6e2c9e">getLastInsertId</a> ()</td></tr>
<tr class="memdesc:ac8aac8ba065bf2f14d1861969a6e2c9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the last insert ID.  <a href="#ac8aac8ba065bf2f14d1861969a6e2c9e"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Handle connection to MySQL/MariaDB server. </p>
<p>Used to authenicate clients, store, retrieve, and update patron information. </p>

<p>Definition at line <a class="el" href="sqlconn_8hpp_source.html#l00115">115</a> of file <a class="el" href="sqlconn_8hpp_source.html">sqlconn.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aa2995f013e14fbb9c195b6aa7226588b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MySQLConn::MySQLConn </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor. </p>

<p>Definition at line <a class="el" href="sqlconn_8hpp_source.html#l00124">124</a> of file <a class="el" href="sqlconn_8hpp_source.html">sqlconn.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a1a78abd249f89676dd3ae9cffe121ba0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MySQLConn::~MySQLConn </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deconstructor. </p>

<p>Definition at line <a class="el" href="sqlconn_8hpp_source.html#l00130">130</a> of file <a class="el" href="sqlconn_8hpp_source.html">sqlconn.hpp</a>.</p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a045c9cb16434df8c1e50dd7ef6766c5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::addLocation </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>loc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Insert a new location into the database. </p>
<p>Generates SHA256 hash of location that will be used as the unique value of the location. The plaintext of the location and first 8 bytes of the hash are then inserted into the database. The lid/unique location id are then returned.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">loc</td><td>The location as a string </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="classMySQLConn.html#a0ab687f92039d6f9934bcd638eecd8e6" title="Return SHA256 hash of input string sdata.">getSHA256Hash</a> </dd>
<dd>
<a class="el" href="classMySQLConn.html#ac8aac8ba065bf2f14d1861969a6e2c9e" title="Returns the last insert ID.">getLastInsertId</a> </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000010">Todo:</a></b></dt><dd>Handle SQLException better </dd></dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00411">411</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a017c08a9bfdf5c20509f754af7c8c7f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::addPatron </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>carnum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">Request</a> *&#160;</td>
          <td class="paramname"><em>i_aPBReq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a new patron to the database. </p>
<p>Insert the patron information for every new patron contained in i_aPBReq into the database.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">carnum</td><td>The car number of the client adding new patrons </td></tr>
    <tr><td class="paramname">i_aPBReq</td><td>The request from the client containing the new patrons to be inserted into the database. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>The first pid of the new patrons that were inserted. Actually it is the last pid minus the number of patrons added, which should be the first pid assuming pid is autoincremented. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>Handle SQLException better </dd></dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00438">438</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ae96f09e4aa859a5294c90ec498c38928"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::checkAuth </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>i_snetid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>i_sauth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>i_scarnum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Authenticate client. </p>
<p>Authenticate the client and bind the NetId to the car number. This also ensures that no other car registers as the same car number.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">i_snetid</td><td>The NetID of the ride along in the car </td></tr>
    <tr><td class="paramname">i_sauth</td><td>The nightly hash </td></tr>
    <tr><td class="paramname">i_scarnum</td><td>The car number as a string </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>0 if successful and &gt;0 if not </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>Implement. This only verifies that the three fields are not empty strings. It must actually query the database and add the information to the DB for later verification. </dd></dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00148">148</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ab0a639e5ebb4220e82f4e4f994059774"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::execAuth </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>hash</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unimplemented. I don't remember what this was supposed to do. </p>

</div>
</div>
<a class="anchor" id="a0e7b657d78b0ab3199519546c8acae49"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gnutls_datum_t MySQLConn::getConnection </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gnutls_datum_t&#160;</td>
          <td class="paramname"><em>session_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve client session info used for session resume. </p>
<p>Using ptr and session_id find and return the session data.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td>pointer </td></tr>
    <tr><td class="paramname">session_id</td><td>gnutls_datum_t holding session id </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>session_data gnutls_datum_t holding session data </dd></dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00103">103</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a259785bc51cae6d0c6c950f6bdf6f475"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::getCurr </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>carnum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classPatronList.html">PatronList</a> *&#160;</td>
          <td class="paramname"><em>i_apbPatl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int &gt;&#160;</td>
          <td class="paramname"><em>old</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return all rides currently assigned to the client. </p>
<p>Query the database for all cars currently assigned to the client with the given car number. For each car returned, check if the patron id is contained in old which contains all rides the client already knows about. We don't want to send excessive information, so we skip all patron information that would duplicate that which is alreadi in the client's database. When these patrons have been excluded, populate the <a class="el" href="classPatronList.html">PatronList</a> with all unique patrons.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">carnum</td><td>The car number of the client </td></tr>
    <tr><td class="paramname">i_apbPatl</td><td>The <a class="el" href="classPatronList.html">PatronList</a> that will contain the patron information </td></tr>
    <tr><td class="paramname">old</td><td>The Vector that contains all the patron ids that the client already has </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>If successful, 0, otherwise -1. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd><p class="startdd">If pid is in old but fields have been modified after last update, resend patron or only resend modified fields. </p>
<p>Check that all rides in old are still assigned to carnum and inform client to remove patron from database if the patron has been reassigned. </p>
<p class="enddd">Handle SQLException better </p>
</dd></dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00167">167</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ac8aac8ba065bf2f14d1861969a6e2c9e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::getLastInsertId </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the last insert ID. </p>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00380">380</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a8ffe3e96eb70c795c4ade821e70dd6bf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::getLocationID </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>loc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the lid of loc. </p>
<p>If loc is in the database then the query will return the proper lid. If loc is NOT in the database then loc will be added to the database and that insert id is returned.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">loc</td><td>Location as a string </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>LID / unique location ID of location </dd></dl>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="classMySQLConn.html#a045c9cb16434df8c1e50dd7ef6766c5f" title="Insert a new location into the database.">addLocation</a> </dd>
<dd>
getLastInsertID </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000012">Todo:</a></b></dt><dd>Handle SQLException better </dd></dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00281">281</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ae26fdad9114c884ff5b8bfefebee4254"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::getPatronInfo </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classPatronList.html">PatronList</a> *&#160;</td>
          <td class="paramname"><em>i_apbPatl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the information in the database for the patron assigned to the pid/unique id pid. </p>
<p>Populate the <a class="el" href="classPatronList.html">PatronList</a> i_apbPatl with the information returned by the query to the database.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">pid</td><td>The patron's unique id </td></tr>
    <tr><td class="paramname">i_apbPatl</td><td>The <a class="el" href="classPatronList.html">PatronList</a> to be populated </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">Todo:</a></b></dt><dd>Handle SQLException better </dd></dl>
<dl class="exception"><dt>Exceptions:</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="classPatronException.html">PatronException</a></td><td>If patron is not found in database </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00330">330</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a0ab687f92039d6f9934bcd638eecd8e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string MySQLConn::getSHA256Hash </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>sdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return SHA256 hash of input string sdata. </p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">sdata</td><td>Input string </td></tr>
    <tr><td class="paramname">size</td><td>The size of sdata in bytes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00478">478</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a1653065e63d0dc420392b5694e688237"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">map&lt; int, string &gt; MySQLConn::setUpdt </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>carnum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classPatronList.html">PatronList</a> *&#160;</td>
          <td class="paramname"><em>i_apbPatl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">Request</a> *&#160;</td>
          <td class="paramname"><em>i_aPBReq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the information for each patron. </p>
<p>Update the patron info for each patron contained in i_aPBReq. If an error is occurred while updating a patron, add the patron id and error message to map returned.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">carnum</td><td>The car number of the client updating the patrons </td></tr>
    <tr><td class="paramname">i_apbPatl</td><td>Unused </td></tr>
    <tr><td class="paramname">i_aPBReq</td><td>The request from the client containing the patrons to be updated </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>a std::map containing the pid and error returned when the update of that patron was attempted. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd><p class="startdd">Only update fields based on modified fields </p>
<p>Handle conflict resolution </p>
<p class="enddd">Handle SQLException better </p>
</dd></dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00229">229</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a081f010ada91cd0d0f67ab8dddb5d8af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::storeCarInfo </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>ipaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>car</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stores client info that is used for authentication. </p>
<p>After the client is authenticated, we store its IP Address and car number in the database. The next time the client connects, we can verify this client is the same as the previous one.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd>Implement</dd></dl>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">ipaddr</td><td>The IP Address of the client </td></tr>
    <tr><td class="paramname">car</td><td>The car's number </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="acf71076f26a8e4c72c8d6d8376d6b3ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MySQLConn::storeConnection </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gnutls_datum_t&#160;</td>
          <td class="paramname"><em>session_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gnutls_datum_t&#160;</td>
          <td class="paramname"><em>session_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store client session info used for session resume. </p>
<p>By enabling session resume, subsequent sessions are established quicker.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td>pointer </td></tr>
    <tr><td class="paramname">session_id</td><td>gnutls_datum_t holding session id </td></tr>
    <tr><td class="paramname">session_data</td><td>gnutls_datum_t holding session data </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sqlconn_8cc_source.html#l00067">67</a> of file <a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/<a class="el" href="sqlconn_8hpp_source.html">sqlconn.hpp</a></li>
<li>src/<a class="el" href="sqlconn_8cc_source.html">sqlconn.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 8 2012 14:28:57 for GTBServer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1
</small></address>
</body>
</html>
